---
Дата создания: 2025-04-14
ссылки:
  - "[[SQL]]"
  - "[[postgresql]]"
  - "[[Ссылки/t0digital|t0digital]]"
tags:
  - "#CaseWhen"
  - postgres
  - "#psql"
---
Например, мы хотим категоризировать книги по году выхода. Если книга написана до 1950 года, то мы назовём это классикой, если между 1950 и 2010, то назовём это современной книгой, а если позже 2010, то назовём новиночкой. Понятно, что границы и названия могут быть другими, не суть, мне важно показать пример.

```sql
delete from book_detail ;

insert into book_detail (book_id, publication_year) values
    (1, 1928),
    (2, 2022),
    (3, 1956),
    (4, 1836),
    (5, 1835),
    (6, 1925),
    (7, 1926),
    (8, 1864)
on conflict (book_id) do update
set publication_year=excluded.publication_year;

select
    b.book_id,
    b.name,
    bd.publication_year,
    case
        when bd.publication_year < 1950 then 'классика'
        when bd.publication_year between 1950 and 2010 then 'современное'
        when bd.publication_year > 2010 then 'новиночка'
    else 'непонятное'
    end era
from book b
left join book_detail bd using(book_id)
order by publication_year desc nulls last;

|book_id|name                         |publication_year|era        |
|-------|-----------------------------|----------------|-----------|
|2      |Python. К вершинам мастерства|2 022           |новиночка  |
|3      |Судьба человека              |1 956           |современное|
|1      |Тихий Дон                    |1 928           |классика   |
|7      |Остров погибших кораблей     |1 926           |классика   |
|6      |Голова профессора Доуэля     |1 925           |классика   |
|8      |Путешествие к центру Земли   |1 864           |классика   |
|4      |Капитанская дочка            |1 836           |классика   |
|5      |Сказка о рыбаке и рыбке      |1 835           |классика   |
|9      |Дети капитана Гранта         |                |непонятное |
```

И теперь вместо того, чтобы в цикле на Python проходить эти книги и их категоризировать, мы сразу получаем готовые данные из постгреса и можем их использовать. Круть!